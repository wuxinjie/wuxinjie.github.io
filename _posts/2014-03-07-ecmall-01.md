---
layout: post
title: ECMALL源码阅读一：架构
catgroy: THINK
---

最近在阅读ECMALL（C2C商城开源系统）的源码，用来学习PHP。对它的代码细致地看了一遍，但是想要体会里面的精华，就需要详细的分析了。写下这系列文章，一起分析ECMALL。

ECMALL采用面向对象的MVC模式。其面向对象跟MVC的表现都比较清晰。采用了流行的单入口模式，这一方式可以让我们方便统一加载地基础类。而模板引擎也采用了smarty。

###控制器（Controll）：
![Alt text](/public/post/01.png)
ECMALL有2种基础控制器，FrontendApp（前台）和  BackendApp（后台）。我们继承这两种控制器创建自定义控制器。  
命名规则：类名（首字母大写） + .app + .php；  
文件位置：/app；  
类名规则：类名+App  
访问规则：/index.php?app=控制器类&act=方法&param=…  
自定义控制器：

{% highlight php %}
     <?php
    /**
    * 控制器演示类
    * @author CTO
    */
    class Demo1App extends MallbaseApp{
	/**
	* 默认控制器方法
	* @return void
	*/
	Function index(){
		Echo __METHOD__;
	}
	/**
	* Goods方法对应Goods模型
	* @return void
	*/
	function goods(){
		//实例化goods
		$goods = m(‘goods’);
		$id = empty($_GET[‘id’]) ? 0 : intval($_GET[‘id’]);
		if(!$id){
		echo “Warning! Hacking!”;
		return;
	}
	//获取goods信息
	$goods_info = $goods->get_info($id);
	//输出goods信息
	$result = print_r($goods_info);
	}
	//此处的test自定义模型将在下面讲述，暂时略过；
	function test(){
		$test = m(‘test’);
		$data = array(‘name’=>’建航’,”name2”=>”科技”);//name,name2对应表字段
		$test->addData($data);
	}
    }
?>
{% endhighlight %}

###模型分析（Model）：
   ECMALL模型分为业务模型与普通模型，二者皆继承自核心类的BaseModel模型；业务模型是没有表联系的，只有业务逻辑。普通模型跟数据库表一一对应。
   命名规则：类名（首字母大写） + .model+ .php；
   文件位置：/includes/models
   类名规则：类名+Model
   调用规则：普通模型：m(“模型名”）业务模型：BModel(“模型名”)
   自定义控制器：





